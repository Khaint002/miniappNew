<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Timeline Fixed Footer</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <style>
    body {
      display: flex;
      flex-direction: column;
      height: 100vh;
      margin: 0;
    }

    @media print {
      body * {
        visibility: hidden;
        /* ·∫®n to√†n b·ªô n·ªôi dung */
      }

      #bodyBill,
      #bodyBill * {
        visibility: visible;
        /* Ch·ªâ hi·ªán #bodyBill */
      }

      #bodyBill {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }
    }

    .app-card {
      border-radius: 10px;
      padding: 15px;
      background: #f3f3f3;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      margin-bottom: 10px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .app-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }

    .app-icon {
      width: 50px;
      height: 50px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
    }

    .app-title {
      font-weight: bold;
      margin: 0;
    }

    .app-subtitle {
      margin: 0;
      color: #6c757d;
      font-size: 14px;
    }

    .app-version {
      font-size: 12px;
      color: #999;
    }

    .timeline-wrapper {
      position: relative;
      padding: 15px 0;
      background: #fff;
    }

    /* ƒê∆∞·ªùng line n·ªÅn */
    .timeline-line {
      position: absolute;
      top: 32px;
      left: 18px;
      right: 18px;
      height: 3px;
      background: #ccc;
      z-index: 1;
    }

    /* C√°c b∆∞·ªõc */
    .timeline {
      display: flex;
      justify-content: space-between;
      position: relative;
      z-index: 2;
    }

    .step {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
      text-align: center;
    }

    .circle {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: #ccc;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      color: #fff;
      z-index: 2;
      transition: background 0.3s ease, transform 0.3s ease;
    }

    .step.active .circle {
      background: #0d6efd;
      transform: scale(1.1);
    }

    .step.done .circle {
      background: #198754;
      transform: scale(1.1);
    }

    .label {
      margin-top: 6px;
      font-size: 14px;
      white-space: nowrap;
      transition: opacity 0.3s ease;
    }

    .label.inactive {
      opacity: 0.5;
    }

    /* Line ƒë√£ ho√†n th√†nh */
    .timeline-line-fill {
      position: absolute;
      top: 32px;
      left: 18px;
      height: 3px;
      background: #198754;
      z-index: 1;
      transition: width 0.4s ease;
    }

    /* N·ªôi dung cu·ªôn */
    .content {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      background: #f8f9fa;
    }

    .step-content {
      animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Footer c·ªë ƒë·ªãnh */
    .footer-nav {
      background: #fff;
      border-top: 1px solid #ddd;
      padding: 10px;
    }

    .bill-container {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: white;
      display: none;
      flex-direction: column;
      z-index: 999;
    }

    .bill-header {
      background: #f0f0f0;
      padding: 10px;
      display: flex;
      align-items: center;
      font-weight: bold;
    }

    .bill-header i {
      cursor: pointer;
      margin-right: 10px;
    }

    .bill-content {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      font-family: Arial, sans-serif;
    }

    .bill-footer {
      padding: 10px;
      border-top: 1px solid #ccc;
      text-align: center;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    table,
    th,
    td {
      border: 1px solid #ccc;
    }

    th,
    td {
      padding: 5px;
      text-align: left;
    }

    .scroll-tabs {
      overflow-x: auto;
      white-space: nowrap;
      -webkit-overflow-scrolling: touch;
      border-bottom: 1px solid #dee2e6;
    }

    .scroll-tabs .nav-item {
      flex: 0 0 auto;
    }

    .scroll-tabs .nav-link {
      white-space: nowrap;
      color: #333;
      padding: 10px 16px;
    }

    .scroll-tabs .nav-link.active {
      font-weight: bold;
      color: #0d6efd !important;
      border-bottom: 3px solid #0d6efd;
      /* underline ngay tab */
    }

    .scroll-tabs::-webkit-scrollbar {
      display: none;
    }

    .swiper {
      width: 100%;
      height: 100%;
      /* cho demo */
    }

    .swiper-slide {
      height: 100%;
      overflow-y: auto;
      /* Cho ph√©p cu·ªôn n·ªôi dung trong slide */
      -webkit-overflow-scrolling: touch;
      background: #f8f9fa;
      padding: 15px;
    }

    .star-rating {
      font-size: 1.5rem;
      cursor: pointer;
    }

    .star {
      color: #ccc;
      transition: color 0.2s;
    }

    .star.active {
      color: gold;
    }

    .tag-btn.active {
      background: #ff2e55;
      color: white;
      border-color: #ff2e55;
    }

    .login-card {
      max-width: 420px;
      width: 100%;
      border: 1px solid #e5e7eb;
      border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, .05);
      background-color: #f3f3f3;
    }

    .brand-area {
      background: #ebe5e5;
      border-bottom: 1px solid #f1f5f9;
      border-radius: 15px 15px 0 0;
    }

    .form-floating>label {
      color: #6b7280;
    }

    .toggle-password {
      position: absolute;
      right: .75rem;
      top: 50%;
      transform: translateY(-50%);
      border: none;
      background: transparent;
      padding: .25rem;
      color: #6b7280;
    }

    .btn-primary {
      border-radius: .8rem;
    }

    .divider {
      display: flex;
      align-items: center;
      text-align: center;
      color: #9ca3af;
      font-size: .9rem;
    }

    .divider::before,
    .divider::after {
      content: "";
      flex: 1;
      border-bottom: 1px solid #e5e7eb;
      margin: 0 .75rem;
    }

    #menuHeader {
    text-align: center;
    padding: 0 10px 0 20px;
    max-width: 500px;
    width: 100%;
    background-color: #272727;
    height: 50px;
    display: flex;
    justify-content: space-between;
}

.history-avt {
    line-height: 50px;
}

.history-avt img {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    margin-top: 10px;
}

.history-avt p {
    margin-left: 10px;
    color: white;
}
  </style>
</head>

<body>
  <div id="login" class="container d-none d-flex justify-content-center align-items-center min-vh-100">
    <div class="card login-card">
      <div class="brand-area p-4 text-center">
        <div class="d-inline-flex align-items-center gap-2">
          <i class="bi bi-shield-lock fs-3 text-primary"></i>
          <h1 class="h4 m-0">Trang ƒëƒÉng nh·∫≠p</h1>
        </div>
        <p class="text-muted mb-0 mt-2">Ch√†o m·ª´ng quay l·∫°i üëã</p>
      </div>


      <div class="card-body p-4">
        <form class="needs-validation" novalidate>
          <div class="mb-3">
            <div class="form-floating">
              <input type="userName" class="form-control" id="userName" placeholder="user name" required>
              <label for="userName">T√™n ƒëƒÉng nh·∫≠p</label>
              <div class="invalid-feedback">Vui l√≤ng nh·∫≠p email h·ª£p l·ªá.</div>
            </div>
          </div>
          <div class="mb-3 position-relative">
            <div class="form-floating">
              <input type="password" class="form-control" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
              <label for="password">M·∫≠t kh·∫©u</label>
              <div class="invalid-feedback">M·∫≠t kh·∫©u t·ªëi thi·ªÉu 6 k√Ω t·ª±.</div>
            </div>
            <button class="toggle-password" type="button" aria-label="Hi·ªán/·∫©n m·∫≠t kh·∫©u" title="Hi·ªán/·∫©n m·∫≠t kh·∫©u">
              <i class="bi bi-eye" id="toggleIcon"></i>
            </button>
          </div>


          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" value="" id="rememberMe">
              <label class="form-check-label" for="rememberMe">Ghi nh·ªõ t√¥i</label>
            </div>
            <a href="#" class="link-underline link-underline-opacity-0">Qu√™n m·∫≠t kh·∫©u?</a>
          </div>


          <div class="d-grid mb-3">
            <button id="submitLogin" class="btn btn-primary btn-lg" type="submit">
              <i class="bi bi-box-arrow-in-right me-1"></i> ƒêƒÉng nh·∫≠p
            </button>
          </div>


          <div class="divider mb-3">Ho·∫∑c</div>
          <div class="d-grid gap-2">
            <button class="btn btn-outline-secondary" type="button">
              <img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Icon_of_Zalo.svg" alt="Zalo" width="20"
                height="20" class="me-2">
              Ti·∫øp t·ª•c v·ªõi Zalo
            </button>
          </div>
          <div id="backLogin" class="d-grid gap-2 mt-3">
            <button class="btn btn-outline-secondary" type="button">
              <i class="bi bi-arrow-left"></i>
              Quay l·∫°i
            </button>
          </div>
        </form>

      </div>
    </div>
  </div>
  <div id="all">
    <div id="menuHeader">
      <div class="history-avt">
        <div class="d-flex">
          <img class="userAvt" src="https://static.vecteezy.com/system/resources/previews/009/292/244/non_2x/default-avatar-icon-of-social-media-user-vector.jpg" alt="">
          <p class="userName">Kh√°ch</p>
        </div>
      </div>
      <div style="line-height: 50px;">
        <button class="btn btn-danger w-100" id="btnLogin">ƒêƒÉng nh·∫≠p</button>
        <button class="btn btn-danger w-100 d-none" id="Logout">ƒêƒÉng Xu·∫•t</button>
      </div>
    </div>
    <div class="container py-3">
      <h5 class="mb-3">Ch·ª©c nƒÉng:</h5>
      <div id="check" class="app-card" onclick="openApp('check')">
        <div class="d-flex align-items-center">
          <div class="app-icon" style="background-color:#0dcaf0;">
            <i class="bi bi-archive"></i>
          </div>
          <div class="ms-3 flex-grow-1">
            <p class="app-title">L·ªãch s·ª≠ ƒë∆°n gi·∫∑t</p>
            <p class="app-subtitle">L·ªãch s·ª≠ ƒë∆°n gi·∫∑t</p>
          </div>
          <span class="app-version"></span>
        </div>
      </div>

      <div id="giat" class="app-card" onclick="openApp('giat')">
        <div class="d-flex align-items-center">
          <div class="app-icon" style="background-color:#dc3545;">
            <i class="bi bi-card-checklist"></i>
          </div>
          <div class="ms-3 flex-grow-1">
            <p class="app-title">T·∫°o ƒë∆°n gi·∫∑t</p>
            <p class="app-subtitle">T·∫°o ƒë∆°n gi·∫∑t</p>
          </div>
          <span class="app-version"></span>
        </div>
      </div>

      <div id="shipMenu" class="app-card" onclick="openApp('ship')">
        <div class="d-flex align-items-center">
          <div class="app-icon" style="background-color:#fd7e14;">
            <i class="bi bi-clipboard2"></i>
          </div>
          <div class="ms-3 flex-grow-1">
            <p class="app-title">Th√¥ng k√™</p>
            <p class="app-subtitle">Th·ªëng k√™ ƒë∆°n gi·∫∑t</p>
          </div>
          <span class="app-version"></span>
        </div>
      </div>

      <div id="ca" class="app-card" onclick="openApp('ca')">
        <div class="d-flex align-items-center">
          <div class="app-icon" style="background-color:#5edf43;">
            <i class="bi bi-arrow-left-right"></i>
          </div>
          <div class="ms-3 flex-grow-1">
            <p class="app-title">Giao ca</p>
            <p class="app-subtitle">B√†n giao ca sau</p>
          </div>
          <span class="app-version"></span>
        </div>
      </div>
    </div>
    
  </div>
  <div id="create" class="d-none d-flex flex-column" style="height: 100vh;">
    <!-- Timeline -->
    <div class="d-flex align-items-center p-2 border-bottom bg-white">
      <button class="btnBackHome btn btn-link p-0 me-2">
        <i class="bi bi-arrow-left" style="font-size: 1.5rem;"></i>
      </button>
      <h5 class="mb-0">T·∫°o ƒë∆°n gi·∫∑t</h5>
    </div>

    <div class="flex-grow-1 overflow-auto">
      <div class="timeline-wrapper">
        <div class="timeline-line"></div>
        <div class="timeline-line-fill" id="lineFill" style="width:0"></div>
        <div class="timeline" id="timeline">
          <div class="step active">
            <div class="circle">1</div>
            <div class="label">T·∫°o ƒë∆°n</div>
          </div>
          <div class="step">
            <div class="circle">2</div>
            <div class="label">C√¢n v√† ph√¢n lo·∫°i</div>
          </div>
          <div class="step">
            <div class="circle">3</div>
            <div class="label">ƒê∆°n gi√°</div>
          </div>
          <div id="step4" class="step">
            <div class="circle">4</div>
            <div class="label">Thanh to√°n</div>
          </div>
        </div>
      </div>

      <!-- N·ªôi dung -->
      <div class="content">
        <div class="step-content" data-step="0">
          <div class="container-fluid">
            <h3 class="mb-3">Nh·∫≠p th√¥ng tin ƒë∆°n h√†ng</h3>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">T√™n kh√°ch h√†ng:</label>
                <input type="text" class="form-control" placeholder="Nh·∫≠p t√™n kh√°ch h√†ng">
              </div>

              <div class="col-md-6">
                <label class="form-label">ƒê·ªãa ch·ªâ:</label>
                <input type="text" class="form-control" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ">
              </div>
              <div class="col-md-6 col-6">
                <label class="form-label">S·ªë ƒëi·ªán tho·∫°i:</label>
                <input type="text" class="form-control" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
              </div>
              <div class="col-md-6 col-6">
                <label class="form-label">Lo·∫°i gi·∫∑t:</label>
                <select class="form-select">
                  <option>Gi·∫∑t ∆∞·ªõt</option>
                  <option>Gi·∫∑t kh√¥</option>
                </select>
              </div>
            </div>

            <h4 class="mt-4">Ch·ªçn m√°y gi·∫∑t</h4>
            <div class="row g-3">
              <div class="col-md-6 col-6">
                <label class="form-label">M√°y gi·∫∑t</label>
                <select class="form-select">
                  <option>M√°y gi·∫∑t s·ªë 1</option>
                  <option>M√°y gi·∫∑t s·ªë 2</option>
                </select>
              </div>
              <div class="col-md-6 col-6">
                <label class="form-label">M√°y s·∫•y</label>
                <select class="form-select">
                  <option>M√°y s·∫•y s·ªë 1</option>
                  <option>M√°y s·∫•y s·ªë 2</option>
                </select>
              </div>
              <div class="col-md-6 col-6">
                <label class="form-label">Th·ªùi gian d·ª± ki·∫øn:</label>
                <input type="text" class="form-control" placeholder="Gi·∫∑t trong 50 ph√∫t">
              </div>
              <div class="col-md-6 col-6">
                <label class="form-label">L∆∞·ª£t gi·∫∑t:</label>
                <input type="text" class="form-control" placeholder="L∆∞·ª£t 1">
              </div>
            </div>
          </div>
        </div>

        <div class="step-content d-none" data-step="1">
          <h4>C√¢n v√† ph√¢n lo·∫°i ƒë·ªì gi·∫∑t</h4>
          <!-- Form nh·∫≠p -->
          <div class="row g-3 align-items-end">
            <div class="col-md-4 col-12">
              <label class="form-label">Lo·∫°i ƒë·ªì:</label>
              <select class="form-select" id="itemType">
                <option value="Qu·∫ßn √°o (C√°i)">Qu·∫ßn √°o (C√°i)</option>
                <option value="ChƒÉn (C√°i)">ChƒÉn (C√°i)</option>
                <option value="KhƒÉn (C√°i)">KhƒÉn (C√°i)</option>
                <option value="Gi√†y (ƒê√¥i)">Gi√†y (ƒê√¥i)</option>
              </select>
            </div>
            <div class="col-md-3 col-6">
              <label class="form-label">S·ªë l∆∞·ª£ng:</label>
              <input type="number" class="form-control" id="itemQty" min="1" value="1">
            </div>
            <div class="col-md-3 col-6">
              <label class="form-label">S·ªë kg:</label>
              <input type="number" class="form-control" id="itemWeight" min="0.1" step="0.1" value="0.5">
            </div>
            <div class="col-md-2 col-12">
              <button class="btn btn-danger w-100" id="addItem">X√°c nh·∫≠n C√¢n</button>
            </div>
          </div>

          <!-- B·∫£ng hi·ªÉn th·ªã -->
          <div class="mt-4">
            <table class="table table-bordered table-sm" id="itemTable">
              <thead class="table-light">
                <tr>
                  <th>Lo·∫°i ƒë·ªì</th>
                  <th>S·ªë l∆∞·ª£ng</th>
                  <th>S·ªë kg</th>
                  <th>Xo√°</th>
                </tr>
              </thead>
              <tbody>
                <!-- H√†ng s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JS -->
              </tbody>
            </table>
          </div>
        </div>
        <div class="step-content d-none" data-step="2">
          <h4>B·∫£ng ƒë∆°n gi√°</h4>
          <table id="priceTable" class="table table-bordered">
            <thead>
              <tr style="font-size: 12px;">
                <th>S·∫£n ph·∫©m</th>
                <th>Kh·ªëi l∆∞·ª£ng</th>
                <th>ƒê∆°n gi√°</th>
                <th>Th√†nh ti·ªÅn</th>
              </tr>
            </thead>
            <tbody style="font-size: 12px;"></tbody>
            <tfoot>
              <tr>
                <th colspan="3" style="text-align:right;">T·ªïng c·ªông</th>
                <th id="totalAmount">0 ƒë</th>
              </tr>
            </tfoot>
          </table>
          <div class="text-center">
            <button id="success3" class="btn btn-success btn-lg success w-100">Ho√†n t·∫•t t·∫°o ƒë∆°n</button>
          </div>
        </div>
        <div class="step-content d-none" data-step="3">
          <h4>Thanh to√°n</h4>
          <p class="mb-3"></p>

          <!-- T·ªïng ti·ªÅn -->
          <h5 class="text-center mb-4">
            T·ªïng ti·ªÅn: <span id="total-price" class="text-danger fw-bold">0 VND</span>
          </h5>

          <!-- QR Code -->
          <div class="d-flex justify-content-center mb-4">
            <div id="qrcode"></div>
          </div>
          <div class="text-center" style="margin-bottom: 20px;">
            <button id="create-bill" class="btn btn-success btn-lg">T·∫°o bill thanh to√°n</button>
          </div>
          <div class="text-center">
            <button class="btn btn-success btn-lg success">Ho√†n t·∫•t thanh to√°n</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer n√∫t -->
    <div class="footer-nav d-flex justify-content-between gap-2 p-2 border-top bg-white">
      <button class="btn btn-secondary" id="btnBack" disabled>Quay l·∫°i</button>
      <div id="footer-total">
        <button class="btn btn-primary" id="btnNext">Ti·∫øp t·ª•c</button>
      </div>
    </div>
  </div>
  <div id="bill-view" class="d-none">
    <div class="d-flex align-items-center p-2 border-bottom bg-white">
      <button class="btnBackCreate btn btn-link p-0 me-2">
        <i class="bi bi-arrow-left" style="font-size: 1.5rem;"></i>
      </button>
      <h5 class="mb-0">Bill ƒë∆°n gi·∫∑t</h5>
    </div>
    <!-- Header -->
    <div id="bodyBill"
      style="max-width: 360px; margin:auto; border:1px solid #ccc; padding:10px; font-family:Arial; margin-top: 20px; margin-bottom: 20px;">

      <div
        style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #ccc; padding:5px 0;">
        <strong>Phi·∫øu giao nh·∫≠n</strong>
      </div>

      <!-- Th√¥ng tin c·ª≠a h√†ng -->
      <div style="text-align:center; margin-top:10px;">
        <h3>C·ª≠a h√†ng gi·∫∑t - s·∫•y</h3>
        <p>H√† ƒê√¥ng - H√† N·ªôi</p>
        <p>0123.123.123</p>
      </div>

      <!-- Th√¥ng tin kh√°ch -->
      <table style="width:100%; border-collapse:collapse; margin-top:10px;">
        <tr>
          <td><b>T√™n kh√°ch h√†ng:</b></td>
          <td id="bill-customerName"></td>
        </tr>
        <tr>
          <td><b>S·ªë ƒëi·ªán tho·∫°i:</b></td>
          <td id="bill-phone"></td>
        </tr>
        <tr>
          <td><b>Ng√†y:</b></td>
          <td id="bill-date"></td>
        </tr>
        <tr>
          <td><b>Gi·ªù:</b></td>
          <td id="bill-time"></td>
        </tr>
        <tr>
          <td><b>Tr·ªçng l∆∞·ª£ng:</b></td>
          <td id="bill-weight"></td>
        </tr>
      </table>

      <!-- B·∫£ng item -->
      <table border="1" style="width:100%; border-collapse:collapse; margin-top:10px; text-align:center;">
        <thead>
          <tr style="font-size: 12px;">
            <th>D·ªãch v·ª•</th>
            <th>S·ªë l∆∞·ª£ng</th>
            <th>Kh·ªëi l∆∞·ª£ng</th>
            <th>Th√†nh ti·ªÅn</th>
          </tr>
        </thead>
        <tbody id="bill-items" style="font-size: 12px;"></tbody>
      </table>

      <!-- T·ªïng ti·ªÅn -->
      <div class="d-flex justify-content-between">
        <div style="width: 40%; padding: 10px; text-align: center;">
          <div id="qrcodeZalo" style="display: flex; justify-content: center;"></div>
          <div style="font-size: 12px;">
            <i>(Truy c·∫≠p app gi·∫∑t l√† th√¥ng qua QR)</i>
          </div>
        </div>

        <h3 style="width: 60%; text-align:right; margin-top:10px;">T·ªïng: <span id="bill-total"></span> ƒë</h3>
      </div>

    </div>


    <!-- Footer -->
    <div class="footer-nav d-flex justify-content-between gap-2 p-2 border-top bg-white">
      <div></div>
      <div id="footer-total">
        <button class="btn btn-primary" id="btnNext" onclick="window.print()">In Bill</button>
      </div>
    </div>
  </div>
  <div id="list" class="d-none d-flex flex-column" style="height: 100vh;">
    <div id="orderList">
      <div class="d-flex align-items-center p-2 border-bottom bg-white">
        <button class="btnBackHome btn btn-link p-0 me-2">
          <i class="bi bi-arrow-left" style="font-size: 1.5rem;"></i>
        </button>
        <h5 class="mb-0">Theo d√µi ƒë∆°n gi·∫∑t</h5>
      </div>
      <div id="listAll" style="padding: 10px;">

      </div>
    </div>
    <div id="orderDetail" class="d-none bg-white border rounded shadow-sm">
      <div class="d-flex align-items-center p-2 border-bottom bg-white">
        <button class="btnBacklist btn btn-link p-0 me-2">
          <i class="bi bi-arrow-left" style="font-size: 1.5rem;"></i>
        </button>
        <h5 class="mb-0">Chi ti·∫øt ƒë∆°n gi·∫∑t</h5>
      </div>
      <div id="detailContent"></div>
    </div>
  </div>
  <div id="ship" class="d-none d-flex flex-column" style="height: 100vh;">
    <div class="d-flex align-items-center p-2 border-bottom bg-white">
      <button class="btnBackHome btn btn-link p-0 me-2">
        <i class="bi bi-arrow-left" style="font-size: 1.5rem;"></i>
      </button>
      <h5 class="mb-0">Theo d√µi giao h√†ng</h5>
    </div>
    <!-- Tabs -->
    <ul class="nav nav-tabs scroll-tabs flex-nowrap" id="tabMenu">
      <!-- <li class="nav-item d-none"><a class="nav-link " data-bs-toggle="tab" data-index="0">T·∫•t c·∫£</a></li> -->
      <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" data-index="0">ƒê√£ nh·∫≠n ƒë∆°n</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" data-index="1">Ho√†n th√†nh gi·∫∑t</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" data-index="2">Ho√†n th√†nh giao h√†ng</a></li>
      <li class="nav-item d-none"><a class="nav-link" data-bs-toggle="tab" data-index="3">Ho√†n t·∫•t</a></li>
    </ul>

    <!-- N·ªôi dung (Swiper ƒë·ªÉ vu·ªët ngang) -->
    <div class="swiper mySwiper">
      <div class="swiper-wrapper">
        <!-- <div class="swiper-slide" id="listShipAll"></div> -->
        <div class="swiper-slide" id="listNew">N·ªôi dung: Ch·ªù v·∫≠n chuy·ªÉn</div>
        <div class="swiper-slide" id="listShipping">N·ªôi dung: ƒêang v·∫≠n chuy·ªÉn</div>
        <div class="swiper-slide" id="listIsDone">N·ªôi dung: C·∫ßn ƒë√°nh gi√°</div>
        <div class="swiper-slide" id="listDone">N·ªôi dung: Ho√†n t·∫•t</div>
      </div>
    </div>
  </div>
  <div id="CaLV" class="d-none d-flex flex-column container py-3 pt-0" style="height: 100vh;">
    <div class="d-flex align-items-center p-2 border-bottom bg-white">
      <button class="btnBackHome btn btn-link p-0 me-2">
        <i class="bi bi-arrow-left" style="font-size: 1.5rem;"></i>
      </button>
      <h5 class="mb-0">B√†n giao ca l√†m vi·ªác</h5>
    </div>
    <!-- Th√¥ng tin nh√¢n vi√™n -->
    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <p class="mb-1"><strong>Nh√¢n vi√™n b√†n giao:</strong><br>Nguy·ªÖn VƒÉn A</p>
        <p class="mb-0"><strong>Nh√¢n vi√™n nh·∫≠n b√†n giao:</strong><br>Tr·∫ßn Th·ªã B</p>
      </div>
    </div>
  
    <!-- C√°c th·ªëng k√™ -->
    <div class="row g-2">
  
      <div class="col-6">
        <div class="card text-center shadow-sm stat-card" data-type="ALL">
          <div class="card-body py-3">
            <small class="text-muted">ƒê∆°n nh·∫≠n</small>
            <h5 class="fw-bold text-primary mb-0">25</h5>
          </div>
        </div>
      </div>
  
      <div class="col-6">
        <div class="card text-center shadow-sm stat-card" data-type="DONE">
          <div class="card-body py-3">
            <small class="text-muted">ƒê√£ gi·∫∑t</small>
            <h5 class="fw-bold text-success mb-0">18</h5>
          </div>
        </div>
      </div>
  
      <div class="col-6">
        <div class="card text-center shadow-sm stat-card" data-type="ISDONE">
          <div class="card-body py-3">
            <small class="text-muted">Ho√†n th√†nh giao</small>
            <h5 class="fw-bold text-success mb-0">15</h5>
          </div>
        </div>
      </div>
  
      <div class="col-6">
        <div class="card text-center shadow-sm stat-card" data-type="NEW">
          <div class="card-body py-3">
            <small class="text-muted">Ch∆∞a gi·∫∑t</small>
            <h5 class="fw-bold text-danger mb-0">7</h5>
          </div>
        </div>
      </div>
  
      <div class="col-12">
        <div class="card text-center shadow-sm bg-light border-primary">
          <div class="card-body py-3">
            <small class="text-muted">T·ªïng ti·ªÅn thu</small>
            <h4 class="fw-bold text-primary mb-0">12,500,000 ƒë</h4>
          </div>
        </div>
      </div>

      <div class="d-flex justify-content-between mt-3">
        <button class="btn btn-outline-secondary btn-sm">Quay l·∫°i</button>
        <button class="btn btn-primary btn-sm">X√°c nh·∫≠n giao ca</button>
      </div>

    </div>
  </div>
  <!-- Modal -->
  <div class="modal fade" id="reviewModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content bg-white text-dark">
        <div class="modal-header border-0">
          <h5 class="modal-title">ƒê√°nh gi√° s·∫£n ph·∫©m</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">

          <!-- Rating Stars -->
          <div class="text-center mb-2">
            <span class="star fs-3 text-secondary" data-value="1">‚òÖ</span>
            <span class="star fs-3 text-secondary" data-value="2">‚òÖ</span>
            <span class="star fs-3 text-secondary" data-value="3">‚òÖ</span>
            <span class="star fs-3 text-secondary" data-value="4">‚òÖ</span>
            <span class="star fs-3 text-secondary" data-value="5">‚òÖ</span>
            <div id="ratingText" class="mt-1 text-muted">Ch·ªçn ƒë√°nh gi√°</div>
          </div>

          <!-- Tags -->
          <!-- <div class="mb-3">
            <button class="btn btn-outline-secondary btn-sm me-1 tag-btn">ƒê·∫∑c ƒëi·ªÉm</button>
            <button class="btn btn-outline-secondary btn-sm me-1 tag-btn">Ch·∫•t li·ªáu</button>
            <button class="btn btn-outline-secondary btn-sm me-1 tag-btn">K√≠ch c·ª°</button>
          </div> -->

          <!-- Textarea -->
          <div class="mb-2">
            <textarea id="reviewText" class="form-control bg-light text-dark" rows="3" maxlength="300"
              placeholder="Chia s·∫ª suy nghƒ© c·ªßa b·∫°n..."></textarea>
            <div class="text-end small mt-1 text-muted"><span id="charCount">0</span>/300</div>
          </div>

          <!-- Upload -->
          <div class="mb-3 text-center p-3 border rounded bg-light" id="uploadBox" style="cursor:pointer;">
            <i class="bi bi-camera fs-2 text-secondary"></i><br>
            <span class="text-secondary">Th√™m ·∫£nh ho·∫∑c video</span>
            <input type="file" id="uploadFile" class="d-none" multiple>
          </div>

          <!-- Anonymous -->
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="anonymousCheck">
            <label class="form-check-label" for="anonymousCheck">ƒê√°nh gi√° ·∫©n danh</label>
          </div>
        </div>
        <div class="modal-footer border-0">
          <button id="submitReview" class="btn w-100" style="background:#ff2e55; color:white;">G·ª≠i</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="detailModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h6 class="modal-title" id="modalTitle">Chi ti·∫øt</h6>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div id="orderLists">
            <!-- Card ƒë∆°n h√†ng s·∫Ω render ·ªü ƒë√¢y -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="scaleAgainModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h6 class="modal-title" id="modalTitle">C√¢n L·∫°i</h6>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="" data-step="1">
            <h4>C√¢n v√† ph√¢n lo·∫°i ƒë·ªì gi·∫∑t</h4>
            <!-- Form nh·∫≠p -->
            <div class="row g-3 align-items-end">
              <div class="col-md-4 col-12">
                <label class="form-label">Lo·∫°i ƒë·ªì:</label>
                <select class="form-select" id="itemTypeAgain">
                  <option value="Qu·∫ßn √°o (C√°i)">Qu·∫ßn √°o (C√°i)</option>
                  <option value="ChƒÉn (C√°i)">ChƒÉn (C√°i)</option>
                  <option value="KhƒÉn (C√°i)">KhƒÉn (C√°i)</option>
                  <option value="Gi√†y (ƒê√¥i)">Gi√†y (ƒê√¥i)</option>
                </select>
              </div>
              <div class="col-md-3 col-6">
                <label class="form-label">S·ªë l∆∞·ª£ng:</label>
                <input type="number" class="form-control" id="itemQtyAgain" min="1" value="1">
              </div>
              <div class="col-md-3 col-6">
                <label class="form-label">S·ªë kg:</label>
                <input type="number" class="form-control" id="itemWeightAgain" min="0.1" step="0.1" value="0.5">
              </div>
              <div class="col-md-2 col-12">
                <button class="btn btn-danger w-100" id="addItemAgain">X√°c nh·∫≠n C√¢n</button>
              </div>
            </div>
  
            <!-- B·∫£ng hi·ªÉn th·ªã -->
            <div class="mt-4">
              <table class="table table-bordered table-sm" id="itemTableAgain">
                <thead class="table-light">
                  <tr>
                    <th>Lo·∫°i ƒë·ªì</th>
                    <th>S·ªë l∆∞·ª£ng</th>
                    <th>S·ªë kg</th>
                    <th>Xo√°</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- H√†ng s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JS -->
                </tbody>
              </table>
            </div>

            <div class="d-flex justify-content-between mt-3">
              <div></div>
              <button id="successAgain" class="btn btn-primary btn-sm">X√°c nh·∫≠n</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
  <script>
    const steps = document.querySelectorAll(".step");
    const labels = document.querySelectorAll(".label");
    const lineFill = document.getElementById("lineFill");
    const contents = document.querySelectorAll(".step-content");
    const btnNext = document.getElementById("btnNext");
    const btnBack = document.getElementById("btnBack");
    var indexAgain = 0;
    let currentStep = 0;
    var itemObj = {};
    var orders = JSON.parse(localStorage.getItem("ListAll")) || [];

    // ƒê∆°n gi√° m·∫´u (b·∫°n c√≥ th·ªÉ thay ƒë·ªïi theo th·ª±c t·∫ø)
    const priceList = {
      "Qu·∫ßn √°o (C√°i)": 25000, // ƒë∆°n gi√° m·ªói kg
      "ChƒÉn (C√°i)": 50000,
      "KhƒÉn (C√°i)": 10000,
      "Gi√†y (ƒê√¥i)": 50000
    };

    async function updateSteps() {
      const login = JSON.parse(localStorage.getItem("dataLogin")) || [];
      if(login.length != 0){
        $(".userName").text(login.name);
        $("#Logout").removeClass('d-none');
        $("#btnLogin").addClass('d-none');
        $('#step4').addClass('d-none');
        $('#check').addClass('d-none');
      } else {
        $('#shipMenu').addClass('d-none');
        $('#ca').addClass('d-none');
        $('#check').removeClass('d-none');
      }
      
      steps.forEach((step, i) => {
        const circle = step.querySelector(".circle");
        const label = step.querySelector(".label");

        if (i < currentStep) {
          step.classList.add("done");
          step.classList.remove("active");
          circle.innerHTML = '<i class="bi bi-check-lg"></i>';
          label.classList.remove("inactive");
        } else if (i === currentStep) {
          step.classList.add("active");
          step.classList.remove("done");
          circle.textContent = i + 1;
          label.classList.remove("inactive");
        } else {
          step.classList.remove("active", "done");
          circle.textContent = i + 1;
          label.classList.add("inactive");
        }
      });

      const percent = (currentStep / (steps.length - 1)) * 100;
      lineFill.style.width = percent + "%";

      contents.forEach((c, idx) => {
        c.classList.toggle("d-none", idx !== currentStep);
      });

      btnBack.disabled = currentStep === 0;
      btnNext.disabled = currentStep === steps.length - 1;

      // Khi ƒë·∫øn b∆∞·ªõc ƒë∆°n gi√° -> render b·∫£ng ƒë∆°n gi√°
      if (currentStep === 2) {
        renderPriceTable();
      }
    }

    btnNext.addEventListener("click", () => {
      if (currentStep < steps.length - 1) {
        currentStep++;
        const login = JSON.parse(localStorage.getItem("dataLogin")) || [];
        if(currentStep == 2 && login.length != 0){
          console.log(1);
          $("#success3").removeClass('d-none');
          setTimeout(() => {
            $("#btnNext").prop("disabled", true);
          }, 500);
        } else {
          $("#success3").addClass('d-none');
        }
        updateSteps();
      }
    });

    btnBack.addEventListener("click", () => {
      if (currentStep > 0) {
        document.getElementById("btnNext").disabled = true;
        currentStep--;
        updateSteps();
      }
    });

    // B∆∞·ªõc 2: C√¢n v√† ph√¢n lo·∫°i
    const itemType = document.getElementById("itemType");
    const itemQty = document.getElementById("itemQty");
    const itemWeight = document.getElementById("itemWeight");
    const itemTypeAgain = document.getElementById("itemTypeAgain");
    const itemQtyAgain = document.getElementById("itemQtyAgain");
    const itemWeightAgain = document.getElementById("itemWeightAgain");
    const addItemBtn = document.getElementById("addItem");
    const addItemAgainBtn = document.getElementById("addItemAgain");
    const itemTableBody = document.querySelector("#itemTable tbody");
    const itemTableAgainBody = document.querySelector("#itemTableAgain tbody");

    addItemBtn.addEventListener("click", () => {
      const type = itemType.value.trim();
      const qty = parseInt(itemQty.value);
      const weight = parseFloat(itemWeight.value);

      if (!type || qty <= 0 || weight <= 0) {
        alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß v√† h·ª£p l·ªá");
        return;
      }

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${type}</td>
        <td>${qty}</td>
        <td>${weight.toFixed(1)}</td>
        <td class="text-center">
          <button class="btn btn-sm btn-outline-danger delete-item"><i class="bi bi-trash"></i></button>
        </td>
      `;
      itemTableBody.appendChild(row);

      // Reset input
      itemQty.value = 1;
      itemWeight.value = 0.5;
    });

    addItemAgainBtn.addEventListener("click", () => {
      const type = itemTypeAgain.value.trim();
      const qty = parseInt(itemQtyAgain.value);
      const weight = parseFloat(itemWeightAgain.value);

      if (!type || qty <= 0 || weight <= 0) {
        alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß v√† h·ª£p l·ªá");
        return;
      }

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${type}</td>
        <td>${qty}</td>
        <td>${weight.toFixed(1)}</td>
        <td class="text-center">
          <button class="btn btn-sm btn-outline-danger delete-item"><i class="bi bi-trash"></i></button>
        </td>
      `;
      itemTableAgainBody.appendChild(row);

      // Reset input
      itemQty.valueAgain = 1;
      itemWeight.valueAgain = 0.5;
    });

    // X√≥a h√†ng
    itemTableAgainBody.addEventListener("click", (e) => {
      if (e.target.closest(".delete-item")) {
        e.target.closest("tr").remove();
      }
    });

    // Render b·∫£ng ƒë∆°n gi√°
    function renderPriceTable() {
      const priceTableBody = document.querySelector("#priceTable tbody");
      const totalAmountEl = document.getElementById("totalAmount");

      priceTableBody.innerHTML = "";
      let total = 0;

      document.querySelectorAll("#itemTable tbody tr").forEach(row => {
        const type = row.cells[0].textContent;
        const qty = parseInt(row.cells[1].textContent);
        const weight = parseFloat(row.cells[2].textContent);

        const unitPrice = priceList[type] || 0;
        const amount = unitPrice * weight; // t√≠nh theo kg

        total += amount;

        const tr = document.createElement("tr");
        tr.innerHTML = `
        <td>${type}</td>
        <td>${weight.toFixed(1)} kg</td>
        <td>${unitPrice.toLocaleString()} ƒë/kg</td>
        <td>${amount.toLocaleString()} ƒë</td>
      `;
        priceTableBody.appendChild(tr);
      });

      totalAmountEl.textContent = total.toLocaleString() + " ƒë";
      renderPaymentStep(total);
      const orderData = createOrderObject(total);
      itemObj = orderData;
      console.log(orderData);
    }

    function renderPaymentStep(totalPriceValue) {
      document.getElementById("total-price").textContent =
        totalPriceValue.toLocaleString() + " VND";

      // X√≥a QR c≈© (n·∫øu c√≥)
      document.getElementById("qrcode").innerHTML = "";

      // Sinh QR code (gi·∫£ s·ª≠ n·ªôi dung l√† link thanh to√°n Momo ho·∫∑c th√¥ng tin thanh to√°n)
      new QRCode(document.getElementById("qrcode"), {
        text: "https://thanhtoan.example.com/?amount=" + totalPriceValue,
        width: 200,
        height: 200
      });
    }

    var swiper = new Swiper(".mySwiper", {
      spaceBetween: 0,
      on: {
        slideChange: function () {
          let index = this.activeIndex; // l·∫•y index slide hi·ªán t·∫°i
          $("#tabMenu .nav-link").removeClass("active");
          $('#tabMenu .nav-link[data-index="' + index + '"]').addClass("active");
          scrollTabToCenter($('#tabMenu .nav-link[data-index="' + index + '"]'));
        }
      }
    });

    // Click tab -> chuy·ªÉn slide
    $("#tabMenu .nav-link").on("click", function () {
      let index = $(this).data("index");
      swiper.slideTo(index);
    });

    // Auto scroll tab v√†o gi·ªØa
    function scrollTabToCenter($item) {
      let $container = $("#tabMenu");
      let containerWidth = $container.width();
      let itemPos = $item.position().left + $container.scrollLeft();
      let itemWidth = $item.outerWidth();
      let scrollPos = itemPos - (containerWidth / 2) + (itemWidth / 2);
      $container.animate({ scrollLeft: scrollPos }, 300);
    }

    function openApp(appName) {
      if (appName === 'giat') {
        document.getElementById("create").classList.remove("d-none");
        document.getElementById("all").classList.add("d-none");
      } else if (appName === 'check') {
        createListOrder();
        document.getElementById("list").classList.remove("d-none");
        document.getElementById("all").classList.add("d-none");
      } else if (appName === 'ship') {
        renderListOrder();
        document.getElementById("ship").classList.remove("d-none");
        document.getElementById("all").classList.add("d-none");
      } else if (appName === 'ca') {
        renderListOrder();
        document.getElementById("CaLV").classList.remove("d-none");
        document.getElementById("all").classList.add("d-none");
      } else {
        alert('M·ªü ·ª©ng d·ª•ng: ' + appName);
      }
    }

    $(".btnBackHome").click(() => {
      document.getElementById("list").classList.add("d-none");
      document.getElementById("create").classList.add("d-none");
      document.getElementById("ship").classList.add("d-none");
      document.getElementById("CaLV").classList.add("d-none");
      document.getElementById("all").classList.remove("d-none");
    })
    $(".btnBacklist").click(() => {
      document.getElementById("orderList").classList.remove("d-none");
      document.getElementById("orderDetail").classList.add("d-none");
    })
    $(".btnBackCreate").click(() => {
      document.getElementById("bill-view").classList.add("d-none");
      document.getElementById("create").classList.remove("d-none");
    })
    $(".success").click(() => {
      let ListAll = JSON.parse(localStorage.getItem("ListAll")) || [];
      ListAll.push(itemObj);
      orders = ListAll;
      localStorage.setItem("ListAll", JSON.stringify(ListAll));

      document.getElementById("create").classList.add("d-none");
      document.getElementById("all").classList.remove("d-none");
      toastr.success("T·∫°o ƒë∆°n gi·∫∑t th√†nh c√¥ng.");
    })

    $("#create-bill").click(() => {
      document.getElementById("create").classList.add("d-none");
      document.getElementById("bill-view").classList.remove("d-none");
      showBill()
    })

    function createOrderObject(total) {
      const login = JSON.parse(localStorage.getItem("dataLogin")) || [];
      let type = 'AUTOMATIC';
      if(login.length != 0){
        type = 'HANDMADE';
      }

      // L·∫•y th√¥ng tin t·ª´ form
      const order = {
        customerName: document.querySelector('input[placeholder="Nh·∫≠p t√™n kh√°ch h√†ng"]').value.trim(),
        address: document.querySelector('input[placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ"]').value.trim(),
        phone: document.querySelector('input[placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i"]').value.trim(),
        washType: document.querySelectorAll('select')[0].value, // Lo·∫°i gi·∫∑t
        machineWash: document.querySelectorAll('select')[1].value, // M√°y gi·∫∑t
        machineDry: document.querySelectorAll('select')[2].value,  // M√°y s·∫•y
        estimatedTime: document.querySelector('input[placeholder="Gi·∫∑t trong 50 ph√∫t"]').value.trim(),
        washTurn: document.querySelector('input[placeholder="L∆∞·ª£t 1"]').value.trim(),
        totalAmount: total,
        items: [],
        status: 'NEW',
        createdType: type,
        createdAt: new Date().toLocaleString()
      };

      // L·∫•y danh s√°ch s·∫£n ph·∫©m t·ª´ b·∫£ng #itemTable
      document.querySelectorAll("#itemTable tbody tr").forEach(row => {
        const type = row.cells[0].textContent;
        const qty = parseInt(row.cells[1].textContent);
        const weight = parseFloat(row.cells[2].textContent);

        const unitPrice = priceList[type] || 0;
        const amount = unitPrice * weight; // t√≠nh theo kg

        order.items.push({
          type,
          qty,
          weight,
          amount
        });
      });

      return order;
    }

    function createListOrder() {
      let listAllContainer = document.getElementById("listAll");
      listAllContainer.innerHTML = "";

      // Hi·ªÉn th·ªã r√∫t g·ªçn
      orders
        .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
        .forEach((order, index) => {
          // L·∫•y 3-4 s·ªë cu·ªëi ƒëi·ªán tho·∫°i
          const phoneSuffix = order.phone ? order.phone.slice(-4) : "N/A";

          // Format th·ªùi gian (c·∫Øt ng·∫Øn g·ªçn)
          const timeString = order.createdAt
            ? new Date(order.createdAt).toLocaleString("vi-VN")
            : "Ch∆∞a c√≥ th·ªùi gian";

          const textButton = order.status == 'ISDONE' ?
            `
            <div class="mt-2" style="display: flex; justify-content: end;">
              <button class="btn btn-sm review-btn" data-index="${index}" style="background-color: #f54646; color: white;">
                Vi·∫øt ƒë√°nh gi√°
              </button>
            </div>
          `: '';

          let orderHTML = `
      <div class="card mb-2 order-item" data-index="${index}">
        <div class="card-body d-flex justify-content-between align-items-center">
          <div>
            <div class="fw-bold">
              ${order.customerName} - ${phoneSuffix}
            </div>
            <small class="text-muted">
              ${timeString} - ${order.status}
            </small>
          </div>
          <div class="fw-bold text-primary" style="text-align: end;">
            ${order.totalAmount.toLocaleString("vi-VN")} ƒë
            <div class="fw-bold" >
              ${textButton}
            </div>
          </div>
        </div>
      </div>
    `;
          listAllContainer.innerHTML += orderHTML;
        });

        document.querySelectorAll(".review-btn").forEach(btn => {
          btn.addEventListener("click", function () {
            let orderIndex = this.getAttribute("data-index");

            // reset modal tr∆∞·ªõc
            document.querySelectorAll("#reviewModal .star").forEach(s => s.classList.remove("active"));
            document.getElementById("ratingText").innerText = "Ch·ªçn ƒë√°nh gi√°";
            document.getElementById("reviewText").value = "";
            document.getElementById("charCount").innerText = "0";
            document.querySelectorAll(".tag-btn").forEach(t => t.classList.remove("active"));
            document.getElementById("anonymousCheck").checked = false;
            document.getElementById("uploadFile").value = "";

            // m·ªü modal
            let modal = new bootstrap.Modal(document.getElementById('reviewModal'));
            modal.show();

            // click sao trong modal
            document.querySelectorAll("#reviewModal .star").forEach(star => {
              star.onclick = function () {
                let value = parseInt(this.getAttribute("data-value"));

                // reset t·∫•t c·∫£ sao v·ªÅ x√°m
                document.querySelectorAll("#reviewModal .star").forEach(s => {
                  s.classList.remove("text-warning");
                  s.classList.add("text-secondary");
                });

                // t√¥ v√†ng t·ª´ 1 -> value
                for (let i = 0; i < value; i++) {
                  document.querySelectorAll("#reviewModal .star")[i].classList.remove("text-secondary");
                  document.querySelectorAll("#reviewModal .star")[i].classList.add("text-warning");
                }

                // ƒë·ªïi text hi·ªÉn th·ªã
                const texts = ["R·∫•t t·ªá", "T·ªá", "B√¨nh th∆∞·ªùng", "T·ªët", "Xu·∫•t s·∫Øc"];
                document.getElementById("ratingText").innerText = texts[value - 1] || "Ch·ªçn ƒë√°nh gi√°";

                // l∆∞u rating v√†o modal
                document.getElementById("reviewModal").setAttribute("data-rating", value);
              };
            });

            // ƒë·∫øm k√Ω t·ª± textarea
            document.getElementById("reviewText").oninput = function () {
              document.getElementById("charCount").innerText = this.value.length;
            };

            // ch·ªçn tag
            document.querySelectorAll(".tag-btn").forEach(tag => {
              tag.onclick = function () {
                this.classList.toggle("active");
              };
            });

            // click v√†o upload box
            document.getElementById("uploadBox").onclick = function () {
              document.getElementById("uploadFile").click();
            };

            // submit review
            document.getElementById("submitReview").onclick = () => {
              let rating = document.getElementById("reviewModal").getAttribute("data-rating") || 0;
              let text = document.getElementById("reviewText").value;
              let tags = Array.from(document.querySelectorAll(".tag-btn.active")).map(t => t.innerText);
              let anonymous = document.getElementById("anonymousCheck").checked;
              let files = document.getElementById("uploadFile").files;

              alert(`
              ƒê√°nh gi√° ƒë∆°n h√†ng #${orderIndex}
              Sao: ${rating}
              N·ªôi dung: ${text}
              Tag: ${tags.join(", ")}
              ·∫®n danh: ${anonymous}
              S·ªë file upload: ${files.length}
            `);

              modal.hide();
            };
          });
        });

      document.querySelectorAll(".order-item").forEach(el => {
        el.addEventListener("click", function () {
          let index = this.getAttribute("data-index");
          let o = orders[index];

          // ·∫®n danh s√°ch, hi·ªán chi ti·∫øt
          document.getElementById("orderList").classList.add("d-none");
          document.getElementById("orderDetail").classList.remove("d-none");

          // Render chi ti·∫øt
          document.getElementById("detailContent").innerHTML = `
  <div class="p-3">
    <p><strong>Th·ªùi gian:</strong> ${o.createdAt}</p>
    <p><strong>Tr·∫°ng th√°i:</strong> <span class="badge bg-info text-dark">${o.status}</span></p>
    <p><strong>Kh√°ch h√†ng:</strong> ${o.customerName}</p>
    <p><strong>ƒê·ªãa ch·ªâ:</strong> ${o.address}</p>
    <p><strong>S·ªë ƒëi·ªán tho·∫°i:</strong> ${o.phone}</p>
    <p><strong>Lo·∫°i gi·∫∑t:</strong> ${o.washType}</p>
    <p><strong>M√°y gi·∫∑t:</strong> ${o.machineWash}</p>
    <p><strong>M√°y s·∫•y:</strong> ${o.machineDry}</p>
    <h5 class="mt-3 text-primary">T·ªïng ti·ªÅn: ${o.totalAmount.toLocaleString()} ƒë</h5>
    <hr>
    <h6 class="mb-3">Danh s√°ch ƒë·ªì:</h6>
    <div class="table-responsive">
      <table class="table table-sm table-bordered">
        <thead class="table-light">
          <tr>
            <th>STT</th>
            <th>Lo·∫°i</th>
            <th>S·ªë l∆∞·ª£ng</th>
            <th>Kh·ªëi l∆∞·ª£ng (kg)</th>
          </tr>
        </thead>
        <tbody>
          ${o.items.map((item, index) => `
            <tr>
              <td>${index + 1}</td>
              <td>${item.type}</td>
              <td>${item.qty}</td>
              <td>${item.weight}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    </div>
  </div>
`;

        });
      });

      // N√∫t quay l·∫°i
      document.getElementById("btnBack").addEventListener("click", function () {
        document.getElementById("orderDetail").classList.add("d-none");
        document.getElementById("orderList").classList.remove("d-none");
      });
    }

    function getActionButton(order, index) {
      switch (order.status) {
        case "NEW":
          return `<button class="btn btn-sm btn-primary action-btn" 
                    data-index="${index}" data-now="NEW" data-next="DONE">
                    B·∫Øt ƒë·∫ßu gi·∫∑t
                  </button>`;
        case "WASHING":
          return `<button class="btn btn-sm btn-warning action-btn" 
                    data-index="${index}" data-now="WASHING" data-next="DONE">
                    C√¢n l·∫°i
                  </button>`;
        case "DONE":
          return `<button class="btn btn-sm btn-success action-btn" 
                    data-index="${index}" data-now="DONE" data-next="ISDONE">
                    Giao h√†ng
                  </button>`;
        case "ISDONE":
          return ``;
        default:
          return "";
      }
    }


    function renderListOrder() {
      let containers = {
        // all: document.getElementById("listShipAll"),
        new: document.getElementById("listNew"),
        inprogress: document.getElementById("listShipping"),
        done: document.getElementById("listDone"),
        isDone: document.getElementById("listIsDone")
      };

      Object.values(containers).forEach(c => c.innerHTML = "");

      orders.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
        .forEach((order, index) => {
          const phoneSuffix = order.phone ? order.phone.slice(-4) : "N/A";
          // let textButton = '';
          const textButton = getActionButton(order, index, order.createdType);

          let baseHTML = `
          <div class="card mb-2 order-item" data-index="${index}">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <div class="fw-bold">${order.customerName} - ${phoneSuffix}</div>
                  <small class="text-muted">${order.status}</small>
                </div>
                <div class="fw-bold text-primary" style="text-align: end;">
                  ${order.totalAmount.toLocaleString()} ƒë
                  <div class="fw-bold" >
                    ${textButton}
                  </div>
                </div>
              </div>
        `;



          baseHTML += `</div></div>`;

          // containers.all.innerHTML += baseHTML;
          if (order.status === "NEW") containers.new.innerHTML += baseHTML;
          if (order.status === "DONE" || order.status === "WASHING") containers.inprogress.innerHTML += baseHTML;
          if (order.status === "ISDONE") containers.isDone.innerHTML += baseHTML;
          
        });
        $(document).off("click", ".action-btn").on("click", ".action-btn", function (e) {
          e.stopPropagation();

          let index = $(this).data("index");   // index trong m·∫£ng orders
          let now = $(this).data("now");   // tr·∫°ng th√°i hi·ªán t·∫°i
          let next  = $(this).data("next");    // tr·∫°ng th√°i m·ªõi mu·ªën set
          if(now != 'WASHING'){
            // C·∫≠p nh·∫≠t tr·∫°ng th√°i

            if(now == 'NEW' && orders[index].createdType == 'HANDMADE'){
              orders[index].status = 'WASHING';
            } else {
              orders[index].status = next;
            }
            localStorage.setItem("ListAll", JSON.stringify(orders));
            // Render l·∫°i giao di·ªán
            renderListOrder();
          } else {
            indexAgain = index;
            new bootstrap.Modal(document.getElementById('scaleAgainModal')).show();
          }
        });
    }

    function showBill() {

      // Fill data
      document.getElementById('bill-customerName').textContent = itemObj.customerName;
      document.getElementById('bill-phone').textContent = itemObj.phone;

      const date = new Date(itemObj.createdAt);
      document.getElementById('bill-date').textContent = date.toLocaleDateString('vi-VN');
      document.getElementById('bill-time').textContent = date.toLocaleTimeString('vi-VN');

      let totalWeight = 0;
      let html = '';
      itemObj.items.forEach(i => {
        totalWeight += i.weight;
        html += `<tr>
      <td>${i.type}</td>
      <td>${i.qty}</td>
      <td>${i.weight}</td>
      <td>${i.amount.toLocaleString()}</td>
    </tr>`;
      });
      document.getElementById('bill-weight').textContent = totalWeight + " kg";
      document.getElementById('bill-items').innerHTML = html;
      document.getElementById('bill-total').textContent = itemObj.items.reduce((sum, i) => sum + i.amount, 0).toLocaleString();

      document.getElementById("qrcodeZalo").innerHTML = "";

      // Sinh QR code (gi·∫£ s·ª≠ n·ªôi dung l√† link thanh to√°n Momo ho·∫∑c th√¥ng tin thanh to√°n)
      new QRCode(document.getElementById("qrcodeZalo"), {
        text: "https://zalo.me/s/4560528012046048397/",
        width: 100,
        height: 100
      });
    }

    function closeBill() {
      document.getElementById('billView').style.display = 'none';
    }

    var sha1Encode = function (message) {
      function rotate_left(n, s) {
        return (n << s) | (n >>> (32 - s));
      }

      function cvt_hex(val) {
        let str = "";
        let i;
        let v;
        for (i = 7; i >= 0; i--) {
          v = (val >>> (i * 4)) & 0x0f;
          str += v.toString(16);
        }
        return str;
      }

      function utf8_encode(str) {
        return unescape(encodeURIComponent(str));
      }

      let blockstart;
      let i, j;
      const W = new Array(80);
      let H0 = 0x67452301;
      let H1 = 0xEFCDAB89;
      let H2 = 0x98BADCFE;
      let H3 = 0x10325476;
      let H4 = 0xC3D2E1F0;
      let A, B, C, D, E;
      let temp;

      message = utf8_encode(message);
      const msg_len = message.length;

      const word_array = [];
      for (i = 0; i < msg_len - 3; i += 4) {
        j = (message.charCodeAt(i) << 24) |
          (message.charCodeAt(i + 1) << 16) |
          (message.charCodeAt(i + 2) << 8) |
          message.charCodeAt(i + 3);
        word_array.push(j);
      }

      switch (msg_len % 4) {
        case 0:
          i = 0x080000000;
          break;
        case 1:
          i = (message.charCodeAt(msg_len - 1) << 24) | 0x0800000;
          break;
        case 2:
          i = (message.charCodeAt(msg_len - 2) << 24) |
            (message.charCodeAt(msg_len - 1) << 16) |
            0x08000;
          break;
        case 3:
          i = (message.charCodeAt(msg_len - 3) << 24) |
            (message.charCodeAt(msg_len - 2) << 16) |
            (message.charCodeAt(msg_len - 1) << 8) |
            0x80;
          break;
      }

      word_array.push(i);

      while ((word_array.length % 16) !== 14) word_array.push(0);

      word_array.push(msg_len >>> 29);
      word_array.push((msg_len << 3) & 0x0ffffffff);

      for (blockstart = 0; blockstart < word_array.length; blockstart += 16) {
        for (i = 0; i < 16; i++) W[i] = word_array[blockstart + i];
        for (i = 16; i <= 79; i++) W[i] = rotate_left(W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16], 1);

        A = H0;
        B = H1;
        C = H2;
        D = H3;
        E = H4;

        for (i = 0; i <= 19; i++) {
          temp = (rotate_left(A, 5) + ((B & C) | (~B & D)) + E + W[i] + 0x5A827999) & 0x0ffffffff;
          E = D;
          D = C;
          C = rotate_left(B, 30);
          B = A;
          A = temp;
        }

        for (i = 20; i <= 39; i++) {
          temp = (rotate_left(A, 5) + (B ^ C ^ D) + E + W[i] + 0x6ED9EBA1) & 0x0ffffffff;
          E = D;
          D = C;
          C = rotate_left(B, 30);
          B = A;
          A = temp;
        }

        for (i = 40; i <= 59; i++) {
          temp = (rotate_left(A, 5) + ((B & C) | (B & D) | (C & D)) + E + W[i] + 0x8F1BBCDC) & 0x0ffffffff;
          E = D;
          D = C;
          C = rotate_left(B, 30);
          B = A;
          A = temp;
        }

        for (i = 60; i <= 79; i++) {
          temp = (rotate_left(A, 5) + (B ^ C ^ D) + E + W[i] + 0xCA62C1D6) & 0x0ffffffff;
          E = D;
          D = C;
          C = rotate_left(B, 30);
          B = A;
          A = temp;
        }

        H0 = (H0 + A) & 0x0ffffffff;
        H1 = (H1 + B) & 0x0ffffffff;
        H2 = (H2 + C) & 0x0ffffffff;
        H3 = (H3 + D) & 0x0ffffffff;
        H4 = (H4 + E) & 0x0ffffffff;
      }

      const sha1hash = cvt_hex(H0) + cvt_hex(H1) + cvt_hex(H2) + cvt_hex(H3) + cvt_hex(H4);
      return sha1hash.toLowerCase();
    }

    function checkRoleUser(user_id, password, url, check) {
      let sessionItems = JSON.parse(localStorage.getItem('dataSession')) || [];

      if (check === "Export") {
        sessionItems = sessionItems.filter(item => item.url !== url);
        localStorage.setItem('dataSession', JSON.stringify(sessionItems));
      }
      // T√¨m session tr√πng v·ªõi URL
      const existingSession = sessionItems.find(item => item.url === url);

      if (existingSession) {
        // N·∫øu ƒë√£ c√≥ session ‚Üí tr·∫£ v·ªÅ lu√¥n
        return Promise.resolve([{
          StateName: user_id,
          StateId: existingSession.sid // gi·∫£ s·ª≠ b·∫°n l∆∞u `sid` ·ªü ƒë√¢y
        }]);
      }
      // N·∫øu ch∆∞a c√≥ session, g·ªçi API
      const d = {
        Uid: user_id,
        p: password,
        ip: '0.0.0.0',
        a: '6fba9a59-46f1-42e6-baea-b2479fa1eb3b'
      };

      return new Promise((resolve, reject) => {
        $.ajax({
          url: url + "GetSessionId?callback=?",
          type: "GET",
          dataType: "jsonp",
          data: d,
          contentType: "application/json; charset=utf-8",
          success: function (msg) {
            try {
              const state = JSON.parse(msg);
              const newSession = {
                url: url,
                sid: state[0]?.StateId || '', // l∆∞u sid n·∫øu c√≥
                name: state[0]?.StateName || user_id
              };
              console.log(state);
              // C·∫≠p nh·∫≠t localStorage
              sessionItems.push(newSession);
              localStorage.setItem('dataLogin', JSON.stringify(newSession));
              // localStorage.setItem('dataSession', JSON.stringify(sessionItems));
              
              resolve(state);
            } catch (error) {
              reject(error);
            }
          },
          error: function (e, t, x) {
            reject(e);
          }
        });
      });
    }

    $("#btnLogin").click(()=>{
      $("#all").addClass("d-none");
      $("#login").removeClass("d-none");
    })

    $("#Logout").click(()=>{
      $("#all").addClass("d-none");
      $("#login").removeClass("d-none");
      localStorage.setItem('dataLogin', JSON.stringify([]));
      $("#Logout").addClass('d-none');
      $("#btnLogin").removeClass('d-none');
    })

    $("#backLogin").click(()=>{
      $("#all").removeClass("d-none");
      $("#login").addClass("d-none");
      const login = JSON.parse(localStorage.getItem("dataLogin")) || [];
      if(login.length == 0){
        $('#step4').removeClass('d-none');
        $(".userName").text('Kh√°ch');
        $('#shipMenu').addClass('d-none');
        $('#ca').addClass('d-none');
        $('#check').removeClass('d-none');
      }
    })

    $("#submitLogin").click(async function(e) {
      e.preventDefault(); // ch·∫∑n submit m·∫∑c ƒë·ªãnh n·∫øu c√≥

      let username = $("#userName").val().trim();
      let password = $("#password").val().trim();

      if(username === "" || password === ""){
        toastr.error("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß t√™n ƒëƒÉng nh·∫≠p v√† m·∫≠t kh·∫©u");
        return;
      }

      // X·ª≠ l√Ω ti·∫øp, v√≠ d·ª• g·ªçi API
      console.log("T√™n ƒëƒÉng nh·∫≠p:", username);
      console.log("M·∫≠t kh·∫©u:", password);

      var url = 'https://central.homeos.vn/service_XD/service.svc';

      var dataUser = await checkRoleUser("NHANVIEN", sha1Encode("1" + "@1B2c3D4e5F6g7H8").toString(), url + '/');
      if(dataUser){
        toastr.success("ƒëƒÉng nh·∫≠p th√†nh c√¥ng!");
        $("#backLogin").click()
        const login = JSON.parse(localStorage.getItem("dataLogin")) || [];
        $(".userName").text(login.name);
        $("#Logout").removeClass('d-none');
        $("#btnLogin").addClass('d-none');
        $('#step4').addClass('d-none');
        $('#shipMenu').removeClass('d-none');
        $('#ca').removeClass('d-none');
        $('#check').addClass('d-none');
      }
    });

    $(".stat-card").on("click", function(){
      let type = $(this).data("type"); // NEW, ISDONE, ALL, DONE

      // map tr·∫°ng th√°i sang ti√™u ƒë·ªÅ
      let statusTextMap = {
          "NEW": "ch∆∞a gi·∫∑t",
          "DONE": "ƒë√£ gi·∫∑t",
          "ISDONE": "ƒë√£ giao",
          "ALL": "ƒë√£ nh·∫≠n"
      };

      $("#modalTitle").text("Chi ti·∫øt ƒë∆°n " + (statusTextMap[type] || ""));
      $("#orderLists").empty();

      // l·ªçc theo status
      let filtered = type === "ALL" ? orders : orders.filter(o => o.status === type);

      filtered.forEach(o => {
        const phoneSuffix = o.phone ? o.phone.slice(-4) : "N/A";
        let itemHtml = o.items.map(i => `
          <li class="list-group-item d-flex justify-content-between">
            <span>${i.type} x${i.qty} (${i.weight} kg)</span>
            <span>${Number(i.amount || 0).toLocaleString()} ƒë</span>
          </li>
        `).join("");

        $("#orderLists").append(`
          <div class="card mb-2 shadow-sm border-0 rounded-3">
            <div class="card-body p-3">
              <div class="d-flex justify-content-between align-items-center mb-1">
                <div>
                  <div class="fw-bold">${o.customerName} - ${phoneSuffix}</div>
                  <small class="text-muted">${o.status}</small>
                </div>
                <div class="fw-bold text-primary">${o.totalAmount.toLocaleString()} ƒë</div>
              </div>
              <div><strong>Kh√°ch:</strong> ${o.customerName}</div>
              <div><strong>ƒê·ªãa ch·ªâ:</strong> ${o.address}</div>
              <div><strong>ƒêi·ªán tho·∫°i:</strong> ${o.phone}</div>
              <hr class="my-2">
              <ul class="list-group list-group-flush">
                ${itemHtml}
              </ul>
            </div>
          </div>
        `);
      });

      new bootstrap.Modal(document.getElementById('detailModal')).show();
    });

    $("#successAgain").on("click", function(){
      orders[indexAgain].items = [];
      let total = 0;
      document.querySelectorAll("#itemTableAgain tbody tr").forEach(row => {
        const type = row.cells[0].textContent;
        const qty = parseInt(row.cells[1].textContent);
        const weight = parseFloat(row.cells[2].textContent);

        const unitPrice = priceList[type] || 0;
        const amount = unitPrice * weight; // t√≠nh theo kg

        total += amount;

        orders[indexAgain].items.push({
          type,
          qty,
          weight,
          amount
        });
      });
      orders[indexAgain].status = 'DONE';
      orders[indexAgain].totalAmount = total;
      console.log(orders[indexAgain]);
      
      localStorage.setItem("ListAll", JSON.stringify(orders));
      // Render l·∫°i giao di·ªán
      toastr.success("C√¢n l·∫°i th√†nh c√¥ng!")
      bootstrap.Modal.getOrCreateInstance(document.getElementById('scaleAgainModal')).hide();
      renderListOrder();
    })

    updateSteps();

  </script>

</body>

</html>