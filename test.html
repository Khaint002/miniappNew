<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Timeline Fixed Footer</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
  <style>
    body {
      display: flex;
      flex-direction: column;
      height: 100vh;
      margin: 0;
    }
    @media print {
      body * {
        visibility: hidden; /* ·∫®n to√†n b·ªô n·ªôi dung */
      }
      #bodyBill, #bodyBill * {
        visibility: visible; /* Ch·ªâ hi·ªán #bodyBill */
      }
      #bodyBill {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }
    }
    .app-card {
      border-radius: 10px;
      padding: 15px;
      background: #f3f3f3;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 10px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .app-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }
    .app-icon {
      width: 50px;
      height: 50px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
    }
    .app-title {
      font-weight: bold;
      margin: 0;
    }
    .app-subtitle {
      margin: 0;
      color: #6c757d;
      font-size: 14px;
    }
    .app-version {
      font-size: 12px;
      color: #999;
    }
    .timeline-wrapper {
      position: relative;
      padding: 15px 0;
      background: #fff;
    }
    /* ƒê∆∞·ªùng line n·ªÅn */
    .timeline-line {
      position: absolute;
      top: 32px;
      left: 18px;
      right: 18px;
      height: 3px;
      background: #ccc;
      z-index: 1;
    }
    /* C√°c b∆∞·ªõc */
    .timeline {
      display: flex;
      justify-content: space-between;
      position: relative;
      z-index: 2;
    }
    .step {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
      text-align: center;
    }
    .circle {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: #ccc;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      color: #fff;
      z-index: 2;
      transition: background 0.3s ease, transform 0.3s ease;
    }
    .step.active .circle {
      background: #0d6efd;
      transform: scale(1.1);
    }
    .step.done .circle {
      background: #198754;
      transform: scale(1.1);
    }
    .label {
      margin-top: 6px;
      font-size: 14px;
      white-space: nowrap;
      transition: opacity 0.3s ease;
    }
    .label.inactive {
      opacity: 0.5;
    }
    /* Line ƒë√£ ho√†n th√†nh */
    .timeline-line-fill {
      position: absolute;
      top: 32px;
      left: 18px;
      height: 3px;
      background: #198754;
      z-index: 1;
      transition: width 0.4s ease;
    }
    /* N·ªôi dung cu·ªôn */
    .content {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      background: #f8f9fa;
    }
    .step-content {
      animation: fadeIn 0.4s ease;
    }
    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(10px);}
      to {opacity: 1; transform: translateY(0);}
    }
    /* Footer c·ªë ƒë·ªãnh */
    .footer-nav {
      background: #fff;
      border-top: 1px solid #ddd;
      padding: 10px;
    }

    .bill-container {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: white;
    display: none;
    flex-direction: column;
    z-index: 999;
  }
  .bill-header {
    background: #f0f0f0;
    padding: 10px;
    display: flex;
    align-items: center;
    font-weight: bold;
  }
  .bill-header i {
    cursor: pointer;
    margin-right: 10px;
  }
  .bill-content {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
    font-family: Arial, sans-serif;
  }
  .bill-footer {
    padding: 10px;
    border-top: 1px solid #ccc;
    text-align: center;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  table, th, td {
    border: 1px solid #ccc;
  }
  th, td {
    padding: 5px;
    text-align: left;
  }
  </style>
</head>
<body>
  <div id="all" class="container py-3">
    <h5 class="mb-3">Ch·ª©c nƒÉng:</h5>
  
    <div class="app-card" onclick="openApp('check')">
      <div class="d-flex align-items-center">
        <div class="app-icon" style="background-color:#0dcaf0;">
          <i class="bi bi-archive"></i>
        </div>
        <div class="ms-3 flex-grow-1">
          <p class="app-title">Theo d√µi ƒë∆°n gi·∫∑t</p>
          <p class="app-subtitle">Theo d√µi ƒë∆°n gi·∫∑t</p>
        </div>
        <span class="app-version"></span>
      </div>
    </div>
  
    <div class="app-card" onclick="openApp('giat')">
      <div class="d-flex align-items-center">
        <div class="app-icon" style="background-color:#dc3545;">
          <i class="bi bi-card-checklist"></i>
        </div>
        <div class="ms-3 flex-grow-1">
          <p class="app-title">T·∫°o ƒë∆°n gi·∫∑t</p>
          <p class="app-subtitle">T·∫°o ƒë∆°n gi·∫∑t</p>
        </div>
        <span class="app-version"></span>
      </div>
    </div>
  
    <div class="app-card d-none" onclick="openApp('baoHanh')">
      <div class="d-flex align-items-center">
        <div class="app-icon" style="background-color:#fd7e14;">
          üõ†
        </div>
        <div class="ms-3 flex-grow-1">
          <p class="app-title">B·∫£o h√†nh</p>
          <p class="app-subtitle">B·∫£o h√†nh s·∫£n ph·∫©m</p>
        </div>
        <span class="app-version">v1.0.5</span>
      </div>
    </div>
  </div>
  <div id="create" class="d-none d-flex flex-column" style="height: 100vh;">
    <!-- Timeline -->
    <div class="d-flex align-items-center p-2 border-bottom bg-white">
      <button class="btnBackHome btn btn-link p-0 me-2">
        <i class="bi bi-arrow-left" style="font-size: 1.5rem;"></i>
      </button>
      <h5 class="mb-0">T·∫°o ƒë∆°n gi·∫∑t</h5>
    </div>

    <div class="flex-grow-1 overflow-auto">
      <div class="timeline-wrapper">
        <div class="timeline-line"></div>
        <div class="timeline-line-fill" id="lineFill" style="width:0"></div>
        <div class="timeline" id="timeline">
          <div class="step active">
            <div class="circle">1</div>
            <div class="label">T·∫°o ƒë∆°n</div>
          </div>
          <div class="step">
            <div class="circle">2</div>
            <div class="label">C√¢n v√† ph√¢n lo·∫°i</div>
          </div>
          <div class="step">
            <div class="circle">3</div>
            <div class="label">ƒê∆°n gi√°</div>
          </div>
          <div class="step">
            <div class="circle">4</div>
            <div class="label">Thanh to√°n</div>
          </div>
        </div>
      </div>

      <!-- N·ªôi dung -->
      <div class="content">
        <div class="step-content" data-step="0">
          <div class="container-fluid">
            <h3 class="mb-3">Nh·∫≠p th√¥ng tin ƒë∆°n h√†ng</h3>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">T√™n kh√°ch h√†ng:</label>
                <input type="text" class="form-control" placeholder="Nh·∫≠p t√™n kh√°ch h√†ng">
              </div>
              
              <div class="col-md-6">
                <label class="form-label">ƒê·ªãa ch·ªâ:</label>
                <input type="text" class="form-control" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ">
              </div>
              <div class="col-md-6 col-6">
                <label class="form-label">S·ªë ƒëi·ªán tho·∫°i:</label>
                <input type="text" class="form-control" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
              </div>
              <div class="col-md-6 col-6">
                <label class="form-label">Lo·∫°i gi·∫∑t:</label>
                <select class="form-select">
                  <option>Gi·∫∑t ∆∞·ªõt</option>
                  <option>Gi·∫∑t kh√¥</option>
                </select>
              </div>
            </div>
        
            <h4 class="mt-4">Ch·ªçn m√°y gi·∫∑t</h4>
            <div class="row g-3">
              <div class="col-md-6 col-6">
                <label class="form-label">M√°y gi·∫∑t</label>
                <select class="form-select">
                  <option>M√°y gi·∫∑t s·ªë 1</option>
                  <option>M√°y gi·∫∑t s·ªë 2</option>
                </select>
              </div>
              <div class="col-md-6 col-6">
                <label class="form-label">M√°y s·∫•y</label>
                <select class="form-select">
                  <option>M√°y s·∫•y s·ªë 1</option>
                  <option>M√°y s·∫•y s·ªë 2</option>
                </select>
              </div>
              <div class="col-md-6 col-6">
                <label class="form-label">Th·ªùi gian d·ª± ki·∫øn:</label>
                <input type="text" class="form-control" placeholder="Gi·∫∑t trong 50 ph√∫t">
              </div>
              <div class="col-md-6 col-6">
                <label class="form-label">L∆∞·ª£t gi·∫∑t:</label>
                <input type="text" class="form-control" placeholder="L∆∞·ª£t 1">
              </div>
            </div>
          </div>
        </div>
        
        <div class="step-content d-none" data-step="1">
          <h4>C√¢n v√† ph√¢n lo·∫°i ƒë·ªì gi·∫∑t</h4>
          <!-- Form nh·∫≠p -->
          <div class="row g-3 align-items-end">
            <div class="col-md-4 col-12">
              <label class="form-label">Lo·∫°i ƒë·ªì:</label>
              <select class="form-select" id="itemType">
                <option value="Qu·∫ßn √°o (C√°i)">Qu·∫ßn √°o (C√°i)</option>
                <option value="ChƒÉn (C√°i)">ChƒÉn (C√°i)</option>
                <option value="KhƒÉn (C√°i)">KhƒÉn (C√°i)</option>
                <option value="Gi√†y (ƒê√¥i)">Gi√†y (ƒê√¥i)</option>
              </select>
            </div>
            <div class="col-md-3 col-6">
              <label class="form-label">S·ªë l∆∞·ª£ng:</label>
              <input type="number" class="form-control" id="itemQty" min="1" value="1">
            </div>
            <div class="col-md-3 col-6">
              <label class="form-label">S·ªë kg:</label>
              <input type="number" class="form-control" id="itemWeight" min="0.1" step="0.1" value="0.5">
            </div>
            <div class="col-md-2 col-12">
              <button class="btn btn-danger w-100" id="addItem">X√°c nh·∫≠n C√¢n</button>
            </div>
          </div>

          <!-- B·∫£ng hi·ªÉn th·ªã -->
          <div class="mt-4">
            <table class="table table-bordered table-sm" id="itemTable">
              <thead class="table-light">
                <tr>
                  <th>Lo·∫°i ƒë·ªì</th>
                  <th>S·ªë l∆∞·ª£ng</th>
                  <th>S·ªë kg</th>
                  <th>Xo√°</th>
                </tr>
              </thead>
              <tbody>
                <!-- H√†ng s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JS -->
              </tbody>
            </table>
          </div>
        </div>
        <div class="step-content d-none" data-step="2">
          <h4>B·∫£ng ƒë∆°n gi√°</h4>
          <table id="priceTable" class="table table-bordered">
              <thead>
                  <tr style="font-size: 12px;">
                      <th>S·∫£n ph·∫©m</th>
                      <th>Kh·ªëi l∆∞·ª£ng</th>
                      <th>ƒê∆°n gi√°</th>
                      <th>Th√†nh ti·ªÅn</th>
                  </tr>
              </thead>
              <tbody style="font-size: 12px;"></tbody>
              <tfoot>
                  <tr>
                      <th colspan="3" style="text-align:right;">T·ªïng c·ªông</th>
                      <th id="totalAmount">0 ƒë</th>
                  </tr>
              </tfoot>
          </table>
        </div>
        <div class="step-content d-none" data-step="3">
          <h4>Thanh to√°n</h4>
          <p class="mb-3"></p>
          
          <!-- T·ªïng ti·ªÅn -->
          <h5 class="text-center mb-4">
            T·ªïng ti·ªÅn: <span id="total-price" class="text-danger fw-bold">0 VND</span>
          </h5>

          <!-- QR Code -->
          <div class="d-flex justify-content-center mb-4">
            <div id="qrcode"></div>
          </div>
          <div class="text-center" style="margin-bottom: 20px;">
            <button id="create-bill" class="btn btn-success btn-lg">T·∫°o bill thanh to√°n</button>
          </div>
          <div class="text-center">
            <button id="success" class="btn btn-success btn-lg">Ho√†n t·∫•t thanh to√°n</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer n√∫t -->
    <div class="footer-nav d-flex justify-content-between gap-2 p-2 border-top bg-white">
      <button class="btn btn-secondary" id="btnBack" disabled>Quay l·∫°i</button>
      <div id="footer-total">
        <button class="btn btn-primary" id="btnNext">Ti·∫øp t·ª•c</button>
      </div>
    </div>
  </div>
  
  <div id="bill-view" class="d-none" >
    <div class="d-flex align-items-center p-2 border-bottom bg-white">
      <button class="btnBackCreate btn btn-link p-0 me-2">
        <i class="bi bi-arrow-left" style="font-size: 1.5rem;"></i>
      </button>
      <h5 class="mb-0">Bill ƒë∆°n gi·∫∑t</h5>
    </div>
    <!-- Header -->
    <div id="bodyBill" style="max-width: 400px; margin:auto; border:1px solid #ccc; padding:10px; font-family:Arial; margin-top: 20px; margin-bottom: 20px;">

      <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #ccc; padding:5px 0;">
        <strong>Phi·∫øu giao nh·∫≠n</strong>
      </div>
  
    <!-- Th√¥ng tin c·ª≠a h√†ng -->
    <div style="text-align:center; margin-top:10px;">
      <h3>C·ª≠a h√†ng gi·∫∑t - s·∫•y</h3>
      <p>H√† ƒê√¥ng - H√† N·ªôi</p>
      <p>0123.123.123</p>
    </div>
  
    <!-- Th√¥ng tin kh√°ch -->
    <table style="width:100%; border-collapse:collapse; margin-top:10px;">
      <tr>
        <td><b>T√™n kh√°ch h√†ng:</b></td>
        <td id="bill-customerName"></td>
      </tr>
      <tr>
        <td><b>S·ªë ƒëi·ªán tho·∫°i:</b></td>
        <td id="bill-phone"></td>
      </tr>
      <tr>
        <td><b>Ng√†y:</b></td>
        <td id="bill-date"></td>
      </tr>
      <tr>
        <td><b>Gi·ªù:</b></td>
        <td id="bill-time"></td>
      </tr>
      <tr>
        <td><b>Tr·ªçng l∆∞·ª£ng:</b></td>
        <td id="bill-weight"></td>
      </tr>
    </table>
  
    <!-- B·∫£ng item -->
    <table border="1" style="width:100%; border-collapse:collapse; margin-top:10px; text-align:center;">
      <thead>
        <tr style="font-size: 12px;">
          <th>D·ªãch v·ª•</th>
          <th>S·ªë l∆∞·ª£ng</th>
          <th>Kh·ªëi l∆∞·ª£ng</th>
          <th>Th√†nh ti·ªÅn</th>
        </tr>
      </thead>
      <tbody id="bill-items" style="font-size: 12px;"></tbody>
    </table>
  
    <!-- T·ªïng ti·ªÅn -->
     <div class="d-flex justify-content-between">
      <div style="width: 40%; padding: 10px; text-align: center;">
        <div id="qrcodeZalo" style="display: flex; justify-content: center;"></div>
        <div style="font-size: 12px;">
            <i>(Truy c·∫≠p app gi·∫∑t l√† th√¥ng qua QR)</i>
        </div>
    </div>
        
        <h3 style="width: 60%; text-align:right; margin-top:10px;">T·ªïng: <span id="bill-total"></span> ƒë</h3>
     </div>
    
  </div>
    
  
    <!-- Footer -->
    <div class="footer-nav d-flex justify-content-between gap-2 p-2 border-top bg-white">
      <div></div>
      <div id="footer-total">
        <button class="btn btn-primary" id="btnNext" onclick="window.print()">In Bill</button>
      </div>
    </div>
  </div>
  <div id="list" class="d-none d-flex flex-column" style="height: 100vh;">
    <div id="orderList">
      <div class="d-flex align-items-center p-2 border-bottom bg-white">
        <button class="btnBackHome btn btn-link p-0 me-2">
          <i class="bi bi-arrow-left" style="font-size: 1.5rem;"></i>
        </button>
        <h5 class="mb-0">Theo d√µi ƒë∆°n gi·∫∑t</h5>
      </div>
      <div id="listAll" style="padding: 10px;">

      </div>
    </div>
    <div id="orderDetail" class="d-none bg-white border rounded shadow-sm">
      <div class="d-flex align-items-center p-2 border-bottom bg-white">
        <button class="btnBacklist btn btn-link p-0 me-2">
          <i class="bi bi-arrow-left" style="font-size: 1.5rem;"></i>
        </button>
        <h5 class="mb-0">chi ti·∫øt ƒë∆°n gi·∫∑t</h5>
      </div>
      <div id="detailContent"></div>
    </div>
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
<script>
  const steps = document.querySelectorAll(".step");
  const labels = document.querySelectorAll(".label");
  const lineFill = document.getElementById("lineFill");
  const contents = document.querySelectorAll(".step-content");
  const btnNext = document.getElementById("btnNext");
  const btnBack = document.getElementById("btnBack");
  let currentStep = 0;
  var itemObj = {};
  var orders = JSON.parse(localStorage.getItem("ListAll")) || [];

  // ƒê∆°n gi√° m·∫´u (b·∫°n c√≥ th·ªÉ thay ƒë·ªïi theo th·ª±c t·∫ø)
  const priceList = {
    "Qu·∫ßn √°o (C√°i)": 25000, // ƒë∆°n gi√° m·ªói kg
    "ChƒÉn (C√°i)": 50000,
    "KhƒÉn (C√°i)": 10000,
    "Gi√†y (ƒê√¥i)": 50000
  };

  function updateSteps() {
    steps.forEach((step, i) => {
      const circle = step.querySelector(".circle");
      const label = step.querySelector(".label");

      if (i < currentStep) {
        step.classList.add("done");
        step.classList.remove("active");
        circle.innerHTML = '<i class="bi bi-check-lg"></i>';
        label.classList.remove("inactive");
      } else if (i === currentStep) {
        step.classList.add("active");
        step.classList.remove("done");
        circle.textContent = i + 1;
        label.classList.remove("inactive");
      } else {
        step.classList.remove("active", "done");
        circle.textContent = i + 1;
        label.classList.add("inactive");
      }
    });

    const percent = (currentStep / (steps.length - 1)) * 100;
    lineFill.style.width = percent + "%";

    contents.forEach((c, idx) => {
      c.classList.toggle("d-none", idx !== currentStep);
    });

    btnBack.disabled = currentStep === 0;
    btnNext.disabled = currentStep === steps.length - 1;

    // Khi ƒë·∫øn b∆∞·ªõc ƒë∆°n gi√° -> render b·∫£ng ƒë∆°n gi√°
    if (currentStep === 2) {
      renderPriceTable();
    }
  }

  btnNext.addEventListener("click", () => {
    if (currentStep < steps.length - 1) {
      currentStep++;
      updateSteps();
    }
  });

  btnBack.addEventListener("click", () => {
    if (currentStep > 0) {
      currentStep--;
      updateSteps();
    }
  });

  // B∆∞·ªõc 2: C√¢n v√† ph√¢n lo·∫°i
  const itemType = document.getElementById("itemType");
  const itemQty = document.getElementById("itemQty");
  const itemWeight = document.getElementById("itemWeight");
  const addItemBtn = document.getElementById("addItem");
  const itemTableBody = document.querySelector("#itemTable tbody");

  addItemBtn.addEventListener("click", () => {
    const type = itemType.value.trim();
    const qty = parseInt(itemQty.value);
    const weight = parseFloat(itemWeight.value);

    if (!type || qty <= 0 || weight <= 0) {
      alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß v√† h·ª£p l·ªá");
      return;
    }

    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${type}</td>
      <td>${qty}</td>
      <td>${weight.toFixed(1)}</td>
      <td class="text-center">
        <button class="btn btn-sm btn-outline-danger delete-item"><i class="bi bi-trash"></i></button>
      </td>
    `;
    itemTableBody.appendChild(row);

    // Reset input
    itemQty.value = 1;
    itemWeight.value = 0.5;
  });

  // X√≥a h√†ng
  itemTableBody.addEventListener("click", (e) => {
    if (e.target.closest(".delete-item")) {
      e.target.closest("tr").remove();
    }
  });

  // Render b·∫£ng ƒë∆°n gi√°
  function renderPriceTable() {
    const priceTableBody = document.querySelector("#priceTable tbody");
    const totalAmountEl = document.getElementById("totalAmount");

    priceTableBody.innerHTML = "";
    let total = 0;

    document.querySelectorAll("#itemTable tbody tr").forEach(row => {
      const type = row.cells[0].textContent;
      const qty = parseInt(row.cells[1].textContent);
      const weight = parseFloat(row.cells[2].textContent);

      const unitPrice = priceList[type] || 0;
      const amount = unitPrice * weight; // t√≠nh theo kg

      total += amount;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${type}</td>
        <td>${weight.toFixed(1)} kg</td>
        <td>${unitPrice.toLocaleString()} ƒë/kg</td>
        <td>${amount.toLocaleString()} ƒë</td>
      `;
      priceTableBody.appendChild(tr);
    });

    totalAmountEl.textContent = total.toLocaleString() + " ƒë";
    renderPaymentStep(total);
    const orderData = createOrderObject(total);
    itemObj = orderData;
    console.log(orderData);
  }

  function renderPaymentStep(totalPriceValue) {
    document.getElementById("total-price").textContent =
    totalPriceValue.toLocaleString() + " VND";

    // X√≥a QR c≈© (n·∫øu c√≥)
    document.getElementById("qrcode").innerHTML = "";

    // Sinh QR code (gi·∫£ s·ª≠ n·ªôi dung l√† link thanh to√°n Momo ho·∫∑c th√¥ng tin thanh to√°n)
    new QRCode(document.getElementById("qrcode"), {
      text: "https://thanhtoan.example.com/?amount=" + totalPriceValue,
      width: 200,
      height: 200
    });
  }

  function openApp(appName) {
    if(appName === 'giat') {

      document.getElementById("create").classList.remove("d-none");
      document.getElementById("all").classList.add("d-none");
    } else if(appName === 'check'){
      createListOrder();
      document.getElementById("list").classList.remove("d-none");
      document.getElementById("all").classList.add("d-none");
    } else {
      alert('M·ªü ·ª©ng d·ª•ng: ' + appName);
    }
  }

  $(".btnBackHome").click(() => {
    document.getElementById("list").classList.add("d-none");
    document.getElementById("create").classList.add("d-none");
    document.getElementById("all").classList.remove("d-none");
  })
  $(".btnBacklist").click(() => {
    document.getElementById("orderList").classList.remove("d-none");
    document.getElementById("orderDetail").classList.add("d-none");
  })
  $(".btnBackCreate").click(() => {
    document.getElementById("bill-view").classList.add("d-none");
    document.getElementById("create").classList.remove("d-none");
  })
  $("#success").click(() => {
    let ListAll = JSON.parse(localStorage.getItem("ListAll")) || [];
    ListAll.push(itemObj);
    orders = ListAll;
    localStorage.setItem("ListAll", JSON.stringify(ListAll));

    document.getElementById("create").classList.add("d-none");
    document.getElementById("all").classList.remove("d-none");
    toastr.success("T·∫°o ƒë∆°n gi·∫∑t th√†nh c√¥ng.");
  })

  $("#create-bill").click(() => {
    document.getElementById("create").classList.add("d-none");
    document.getElementById("bill-view").classList.remove("d-none");
    showBill()
  })

  function createOrderObject(total) {
    // L·∫•y th√¥ng tin t·ª´ form
    const order = {
        customerName: document.querySelector('input[placeholder="Nh·∫≠p t√™n kh√°ch h√†ng"]').value.trim(),
        address: document.querySelector('input[placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ"]').value.trim(),
        phone: document.querySelector('input[placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i"]').value.trim(),
        washType: document.querySelectorAll('select')[0].value, // Lo·∫°i gi·∫∑t
        machineWash: document.querySelectorAll('select')[1].value, // M√°y gi·∫∑t
        machineDry: document.querySelectorAll('select')[2].value,  // M√°y s·∫•y
        estimatedTime: document.querySelector('input[placeholder="Gi·∫∑t trong 50 ph√∫t"]').value.trim(),
        washTurn: document.querySelector('input[placeholder="L∆∞·ª£t 1"]').value.trim(),
        totalAmount: total,
        items: [],
        status: 'NEW',
        createdAt: new Date().toLocaleString()
    };

    // L·∫•y danh s√°ch s·∫£n ph·∫©m t·ª´ b·∫£ng #itemTable
    document.querySelectorAll("#itemTable tbody tr").forEach(row => {
        const type = row.cells[0].textContent;
        const qty = parseInt(row.cells[1].textContent);
        const weight = parseFloat(row.cells[2].textContent);

        const unitPrice = priceList[type] || 0;
        const amount = unitPrice * weight; // t√≠nh theo kg

        order.items.push({
            type,
            qty,
            weight,
            amount
        });
    });

    return order;
  }

  function createListOrder() {

    let listAllContainer = document.getElementById("listAll");
    listAllContainer.innerHTML = "";

    // Hi·ªÉn th·ªã r√∫t g·ªçn
    orders.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)).forEach((order, index) => {
        let orderHTML = `
            <div class=" card mb-2 order-item" data-index="${index}">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div>
                        <div class="fw-bold">${order.createdAt || "Ch∆∞a c√≥ th·ªùi gian"}</div>
                        <small class="text-muted">${order.status}</small>
                    </div>
                    <div class="fw-bold text-primary">
                        ${order.totalAmount.toLocaleString()} ƒë
                    </div>
                </div>
            </div>
        `;
        listAllContainer.innerHTML += orderHTML;
    });

    document.querySelectorAll(".order-item").forEach(el => {
      el.addEventListener("click", function(){
          let index = this.getAttribute("data-index");
          let o = orders[index];

          // ·∫®n danh s√°ch, hi·ªán chi ti·∫øt
          document.getElementById("orderList").classList.add("d-none");
          document.getElementById("orderDetail").classList.remove("d-none");

          // Render chi ti·∫øt
          document.getElementById("detailContent").innerHTML = `
  <div class="p-3">
    <p><strong>Th·ªùi gian:</strong> ${o.createdAt}</p>
    <p><strong>Tr·∫°ng th√°i:</strong> <span class="badge bg-info text-dark">${o.status}</span></p>
    <p><strong>Kh√°ch h√†ng:</strong> ${o.customerName}</p>
    <p><strong>ƒê·ªãa ch·ªâ:</strong> ${o.address}</p>
    <p><strong>S·ªë ƒëi·ªán tho·∫°i:</strong> ${o.phone}</p>
    <p><strong>Lo·∫°i gi·∫∑t:</strong> ${o.washType}</p>
    <p><strong>M√°y gi·∫∑t:</strong> ${o.machineWash}</p>
    <p><strong>M√°y s·∫•y:</strong> ${o.machineDry}</p>
    <h5 class="mt-3 text-primary">T·ªïng ti·ªÅn: ${o.totalAmount.toLocaleString()} ƒë</h5>
    <hr>
    <h6 class="mb-3">Danh s√°ch ƒë·ªì:</h6>
    <div class="table-responsive">
      <table class="table table-sm table-bordered">
        <thead class="table-light">
          <tr>
            <th>STT</th>
            <th>Lo·∫°i</th>
            <th>S·ªë l∆∞·ª£ng</th>
            <th>Kh·ªëi l∆∞·ª£ng (kg)</th>
          </tr>
        </thead>
        <tbody>
          ${o.items.map((item, index) => `
            <tr>
              <td>${index + 1}</td>
              <td>${item.type}</td>
              <td>${item.qty}</td>
              <td>${item.weight}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    </div>
  </div>
`;

      });
  });

  // N√∫t quay l·∫°i
  document.getElementById("btnBack").addEventListener("click", function(){
      document.getElementById("orderDetail").classList.add("d-none");
      document.getElementById("orderList").classList.remove("d-none");
  });
  }

  function showBill() {

  // Fill data
  document.getElementById('bill-customerName').textContent = itemObj.customerName;
  document.getElementById('bill-phone').textContent = itemObj.phone;

  const date = new Date(itemObj.createdAt);
  document.getElementById('bill-date').textContent = date.toLocaleDateString('vi-VN');
  document.getElementById('bill-time').textContent = date.toLocaleTimeString('vi-VN');

  let totalWeight = 0;
  let html = '';
  itemObj.items.forEach(i => {
    totalWeight += i.weight;
    html += `<tr>
      <td>${i.type}</td>
      <td>${i.qty}</td>
      <td>${i.weight}</td>
      <td>${i.amount.toLocaleString()}</td>
    </tr>`;
  });
  document.getElementById('bill-weight').textContent = totalWeight + " kg";
  document.getElementById('bill-items').innerHTML = html;
  document.getElementById('bill-total').textContent = itemObj.items.reduce((sum, i) => sum + i.amount, 0).toLocaleString();

  document.getElementById("qrcodeZalo").innerHTML = "";

    // Sinh QR code (gi·∫£ s·ª≠ n·ªôi dung l√† link thanh to√°n Momo ho·∫∑c th√¥ng tin thanh to√°n)
  new QRCode(document.getElementById("qrcodeZalo"), {
    text: "https://zalo.me/s/4560528012046048397/",
    width: 100,
    height: 100
  });
}

  function closeBill() {
    document.getElementById('billView').style.display = 'none';
  }

  updateSteps();
</script>

</body>
</html>
